(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))o(i);new MutationObserver(i=>{for(const n of i)if(n.type==="childList")for(const u of n.addedNodes)u.tagName==="LINK"&&u.rel==="modulepreload"&&o(u)}).observe(document,{childList:!0,subtree:!0});function a(i){const n={};return i.integrity&&(n.integrity=i.integrity),i.referrerPolicy&&(n.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?n.credentials="include":i.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function o(i){if(i.ep)return;i.ep=!0;const n=a(i);fetch(i.href,n)}})();const E=["Luna","Maya","Nina","Belinha","Mel","Lola","Pandora","Amora","Sasha","Cacau","Bela","Lili","Frida","Maggie","Julie","Pituca","Molly","Kira","Zara","Sol"],L={small:.8,medium:1,large:1.3},F=()=>({totalCorrect:0,totalDecisions:0,majorMistakes:0,criticalMistakes:0}),P=()=>({currentStep:0,selectedCharacter:null,dogName:"",difficulty:1,storyStats:F()}),r=P();function M(e){r.currentStep=e}function N(e,t){r.selectedCharacter={size:e,breed:t},r.difficulty=L[e]}function I(e){r.dogName=e}function A(){r.storyStats=F()}function w(e){switch(r.storyStats.totalDecisions+=1,e){case"best":r.storyStats.totalCorrect+=1;break;case"critical":r.storyStats.criticalMistakes+=1,r.storyStats.majorMistakes+=1;break;case"bad":r.storyStats.majorMistakes+=1;break}}function O(){const e=document.querySelectorAll(".dog-name-placeholder"),t=r.dogName||"Mel";e.forEach(a=>{a.textContent=t})}function q(e){document.querySelectorAll(".screen").forEach(a=>{a.classList.remove("active")});const t=document.getElementById(e);t&&(t.classList.add("active"),t.scrollTop=0),O()}function h(e){if(M(e),e===0){q("menu");return}q(`step${e}`)}function H(e){document.querySelectorAll(".character-card").forEach(o=>{o.classList.remove("selected")});const a=Array.from(document.querySelectorAll(".character-card")).find(o=>o.querySelector("h3")?.textContent?.trim()===e);a&&a.classList.add("selected")}function B(e,t){H(t),N(e,t)}function z(){const t=(document.getElementById("dogName")?.value||"").trim();if(!r.selectedCharacter){alert("Por favor, escolha uma cadela!");return}if(!t){alert("Por favor, digite um nome para sua cadela!");return}I(t);const a=document.getElementById("selectedDogName");a&&(a.textContent=r.dogName),h(2)}function j(){alert(`üéÆ SOBRE O JOGO

Este √© um jogo educativo sobre hipocalcemia em cadelas gr√°vidas e lactantes.

üéØ Voc√™ aprender√°:
‚Ä¢ Como identificar sintomas
‚Ä¢ Tratamentos adequados
‚Ä¢ Preven√ß√£o da doen√ßa
‚Ä¢ Cuidados durante gravidez e lacta√ß√£o

üìö Baseado em conhecimento veterin√°rio real!`)}function $(){alert(`‚≠ê CR√âDITOS

üéÆ Jogo Educativo: Cuide da Ninhada
Desenvolvido para conscientiza√ß√£o sobre hipocalcemia

üé® Design: Pixel art interativo
üìö Conte√∫do: Baseado em conhecimento veterin√°rio
üéØ Objetivo: Educa√ß√£o e preven√ß√£o

"A preven√ß√£o √© o melhor rem√©dio!"`)}function T(){const e=document.getElementById("dogName");e&&(e.value=E[Math.floor(Math.random()*E.length)])}function R(){document.querySelectorAll("button, .character-card").forEach(a=>{a.addEventListener("touchstart",o=>{const i=o.currentTarget;i&&(i.style.transform="scale(0.95)")},{passive:!0}),a.addEventListener("touchend",o=>{const i=o.currentTarget;i&&(i.style.transform="")},{passive:!0}),a.addEventListener("touchend",o=>{o.preventDefault(),o.currentTarget?.click()})});const t=document.getElementById("dogName");t&&t.addEventListener("focus",()=>{setTimeout(()=>{t.scrollIntoView({behavior:"smooth",block:"center"})},300)})}const V=[{id:"fase1-q1",title:"Pergunta 1 ‚Äì Conceito e base fisiol√≥gica",question:"O que caracteriza a hipocalcemia em cadelas durante a lacta√ß√£o?",options:[{text:"1Ô∏è‚É£ Redu√ß√£o anormal dos n√≠veis s√©ricos de c√°lcio ionizado (< 7 mg/dL) pela alta demanda de leite.",feedback:"ü©∫ Feedback: Correto! A queda brusca de c√°lcio acontece quando a produ√ß√£o de leite supera a reposi√ß√£o corporal, reduzindo a excitabilidade neuromuscular.",tone:"success",outcome:"best"},{text:"2Ô∏è‚É£ Aumento do c√°lcio s√©rico causado pelo uso de suplementa√ß√£o.",feedback:"‚ö†Ô∏è Feedback: Errado. Isso seria hipercalcemia e, pior, pode suprimir o PTH e predispor √† crise ap√≥s o parto.",tone:"warning",outcome:"bad"},{text:"3Ô∏è‚É£ Ac√∫mulo de c√°lcio no √∫tero e ossos fetais.",feedback:"‚ùå Feedback: Parcialmente incorreto ‚Äî o c√°lcio √© transferido aos fetos e ao leite, mas o problema real √© n√£o repor o c√°lcio plasm√°tico perdido.",tone:"neutral",outcome:"bad"}]},{id:"fase1-q2",title:"Pergunta 2 ‚Äì Mecanismo fisiol√≥gico e hormonal",question:"Qual √© o papel do paratorm√¥nio (PTH) na preven√ß√£o da hipocalcemia?",options:[{text:"1Ô∏è‚É£ Estimula a reabsor√ß√£o renal e a libera√ß√£o √≥ssea de c√°lcio, mantendo n√≠veis normais.",feedback:"ü©∫ Feedback: Exato! Com o PTH ativo, o organismo mobiliza c√°lcio rapidamente quando os filhotes come√ßam a mamar.",tone:"success",outcome:"best"},{text:"2Ô∏è‚É£ Reduz a absor√ß√£o intestinal de c√°lcio.",feedback:"‚ùå Feedback: O oposto ocorre. PTH e calcitriol aumentam a absor√ß√£o intestinal.",tone:"neutral",outcome:"bad"},{text:"3Ô∏è‚É£ Estimula a secre√ß√£o de prolactina.",feedback:"‚ö†Ô∏è Feedback: N√£o diretamente. Prolactina √© hipofis√°ria e n√£o regula c√°lcio.",tone:"fun",outcome:"bad"}]},{id:"fase1-q3",title:"Pergunta 3 ‚Äì Grupos de risco",question:"Quais cadelas t√™m maior predisposi√ß√£o √† hipocalcemia puerperal?",options:[{text:"1Ô∏è‚É£ Ra√ßas pequenas com ninhadas numerosas.",feedback:"ü©∫ Feedback: Correto! Pouca reserva mineral e filhotes √°vidos s√£o a combina√ß√£o perfeita para a crise.",tone:"success",outcome:"best"},{text:"2Ô∏è‚É£ Cadelas obesas e sedent√°rias.",feedback:"‚ö†Ô∏è Feedback: A obesidade traz outros problemas (distocia, por exemplo), mas n√£o √© gatilho direto da hipocalcemia.",tone:"warning",outcome:"bad"},{text:"3Ô∏è‚É£ Machos reprodutores idosos.",feedback:"üòÇ Feedback: Hipocalcemia puerperal √© exclusividade das m√£es lactantes. Pode rir, {{dogName}}, mas n√£o conte para eles.",tone:"fun",outcome:"bad"}]},{id:"fase1-q4",title:"Pergunta 4 ‚Äì Sinais cl√≠nicos iniciais",question:"Quais s√£o os primeiros sinais cl√≠nicos de hipocalcemia incipiente?",options:[{text:"1Ô∏è‚É£ Agita√ß√£o, tremores, ofega√ß√£o e rigidez muscular.",feedback:"ü©∫ Feedback: Correto. Esses sinais surgem nas primeiras 24‚Äì72 horas p√≥s-parto e podem evoluir para convuls√µes.",tone:"success",outcome:"best"},{text:"2Ô∏è‚É£ Letargia e sonol√™ncia.",feedback:"‚ùå Feedback: Nas cadelas, a fase inicial √© de hiperexcita√ß√£o, n√£o de apatia.",tone:"neutral",outcome:"bad"},{text:"3Ô∏è‚É£ V√¥mito e diarreia.",feedback:"‚ö†Ô∏è Feedback: N√£o s√£o sinais caracter√≠sticos da hipocalcemia canina.",tone:"warning",outcome:"bad"}]},{id:"fase1-q5",title:"Pergunta 5 ‚Äì Conduta terap√™utica de emerg√™ncia",question:"Qual √© o tratamento de escolha durante uma crise aguda (ecl√¢mpsia canina)?",options:[{text:"1Ô∏è‚É£ Gluconato de c√°lcio IV lento, com monitoriza√ß√£o card√≠aca.",feedback:"ü©∫ Feedback: Exato. Administrar a 10% lentamente enquanto observa a frequ√™ncia card√≠aca para evitar bradicardia.",tone:"success",outcome:"best"},{text:"2Ô∏è‚É£ Ocitocina e massagem abdominal.",feedback:"‚ùå Feedback: In√∫til sem c√°lcio suficiente; pode at√© agravar o quadro.",tone:"neutral",outcome:"bad"},{text:"3Ô∏è‚É£ Apenas retirar os filhotes da m√£e.",feedback:"‚ö†Ô∏è Feedback: Ajuda a reduzir a drenagem de c√°lcio, mas n√£o substitui o tratamento emergencial.",tone:"warning",outcome:"bad"}]}],Q=[{id:"fase2-d1",title:"Decis√£o 1 ‚Äì Alimenta√ß√£o na gesta√ß√£o",narrative:"üìÖ Dia 35 de gesta√ß√£o. O apetite de {{dogName}} aumenta e o tutor entra em p√¢nico.",question:"Como ajustar a nutri√ß√£o?",options:[{text:"1Ô∏è‚É£ Aumentar drasticamente a ra√ß√£o agora.",feedback:"ü©∏ Feedback: Cuidado. Excesso precoce leva √† obesidade gestacional e distocia.",tone:"warning",outcome:"bad"},{text:"2Ô∏è‚É£ Manter a dieta atual e aumentar gradualmente ap√≥s a 5¬™ semana.",feedback:"ü©∫ Feedback: Correto. Energia controlada garante fetos saud√°veis e reservas de c√°lcio equilibradas.",tone:"success",outcome:"best"},{text:"3Ô∏è‚É£ Servir arroz, frango e restos de comida.",feedback:"‚ö†Ô∏è Feedback: Dieta caseira desbalanceada derruba a ingest√£o de c√°lcio e f√≥sforo e prepara o palco da crise.",tone:"warning",outcome:"bad"}]},{id:"fase2-d2",title:"Decis√£o 2 ‚Äì Suplementa√ß√£o de c√°lcio",narrative:"O tutor leu na internet que c√°lcio di√°rio durante toda a gesta√ß√£o evita ecl√¢mpsia.",question:"Qual conduta adotar?",options:[{text:"1Ô∏è‚É£ Autorizar suplementa√ß√£o di√°ria at√© o parto.",feedback:"‚ùå Feedback: P√©ssima escolha. Suprimir o PTH agora impede resposta r√°pida quando os filhotes nascerem.",tone:"neutral",outcome:"bad"},{text:"2Ô∏è‚É£ Contraindicar suplementa√ß√£o at√© o final da gesta√ß√£o (salvo exames espec√≠ficos).",feedback:"ü©∫ Feedback: Perfeito. Reposi√ß√£o s√≥ ap√≥s o parto e de forma monitorada mant√©m o eixo hormonal ativo.",tone:"success",outcome:"best"},{text:"3Ô∏è‚É£ Substituir por leite integral.",feedback:"üòÇ Feedback: Tentativa carinhosa, por√©m in√∫til. A propor√ß√£o Ca:P do leite de vaca √© inadequada e pode desequilibrar mais ainda.",tone:"fun",outcome:"bad"}]},{id:"fase2-d3",title:"Decis√£o 3 ‚Äì Manejo pr√©-natal",narrative:"{{dogName}} est√° com 50 dias de gesta√ß√£o e se mexe como um barril com pernas.",question:"Como garantir um parto tranquilo?",options:[{text:"1Ô∏è‚É£ Incentivar exerc√≠cios leves e controlar o peso.",feedback:"ü©∫ Feedback: Correto! Menos gordura, mais t√¥nus muscular e menos confus√£o com sinais de hipocalcemia.",tone:"success",outcome:"best"},{text:"2Ô∏è‚É£ Deixar {{dogName}} quietinha o tempo todo.",feedback:"‚ö†Ô∏è Feedback: Sedentarismo reduz a resist√™ncia muscular uterina e complica o parto.",tone:"warning",outcome:"bad"},{text:"3Ô∏è‚É£ Aplicar vitaminas e c√°lcio sem consulta.",feedback:"‚ùå Feedback: Automedica√ß√£o gera desequil√≠brios hormonais e minerais perigosos.",tone:"neutral",outcome:"bad"}]},{id:"fase2-d4",title:"Decis√£o 4 ‚Äì Noite pr√©-parto",narrative:"üåô {{dogName}} est√° inquieta, cavando a caminha e ofegante. Contra√ß√µes discretas come√ßam.",question:"Como reagir?",options:[{text:"1Ô∏è‚É£ Observar, preparar o ambiente limpo e anotar o intervalo das contra√ß√µes.",feedback:"ü©∫ Feedback: Perfeito! Monitorar ajuda a detectar atonia uterina precoce relacionada √† hipocalcemia.",tone:"success",outcome:"best"},{text:"2Ô∏è‚É£ For√ßar o parto com ocitocina porque ‚Äúj√° est√° demorando‚Äù.",feedback:"‚ùå Feedback: Sem c√°lcio, a ocitocina √© in√∫til e pode causar ruptura uterina.",tone:"neutral",outcome:"bad"},{text:"3Ô∏è‚É£ Oferecer leite ado√ßado para dar energia.",feedback:"üòÇ Feedback: A√ß√∫car n√£o corrige hipocalcemia e ainda causa fermenta√ß√£o intestinal.",tone:"fun",outcome:"bad"}]}],G=[{id:"fase3-d1",title:"Decis√£o 1 ‚Äì Identificando o problema",narrative:"Dois dias ap√≥s o parto, {{dogName}} est√° inquieta, ofegante e com passos curtos.",question:"Qual atitude tomar?",options:[{text:"1Ô∏è‚É£ Ignorar achando que √© ‚Äúnervosismo de m√£e‚Äù.",feedback:"üö® Feedback: Erro fatal. A hipocalcemia √© urg√™ncia; ignorar leva a convuls√µes e parada.",tone:"danger",outcome:"critical"},{text:"2Ô∏è‚É£ Separar temporariamente os filhotes e verificar a temperatura.",feedback:"ü©∫ Feedback: Correto! Reduz a drenagem de c√°lcio pelo leite e permite avaliar hipertermia (> 40‚ÄØ¬∞C).",tone:"success",outcome:"best"},{text:"3Ô∏è‚É£ Dar um banho para acalmar.",feedback:"‚ö†Ô∏è Feedback: Piora o quadro neuromuscular com estresse e queda de temperatura.",tone:"warning",outcome:"bad"}]},{id:"fase3-d2",title:"Decis√£o 2 ‚Äì Contato com o veterin√°rio",narrative:"Na cl√≠nica, o veterin√°rio suspeita de ecl√¢mpsia puerperal.",question:"Qual exame confirma o diagn√≥stico?",options:[{text:"1Ô∏è‚É£ Dosagem s√©rica de c√°lcio ionizado.",feedback:"ü©∫ Feedback: Exato. Valores abaixo de 7 mg/dL confirmam hipocalcemia.",tone:"success",outcome:"best"},{text:"2Ô∏è‚É£ Radiografia abdominal.",feedback:"‚ùå Feedback: Inadequada aqui. O problema √© bioqu√≠mico, n√£o estrutural.",tone:"neutral",outcome:"bad"},{text:"3Ô∏è‚É£ Ultrassom de √∫tero.",feedback:"‚ö†Ô∏è Feedback: S√≥ √∫til se houver suspeita de reten√ß√£o fetal, n√£o para hipocalcemia.",tone:"warning",outcome:"bad"}]},{id:"fase3-d3",title:"Decis√£o 3 ‚Äì Tratamento imediato",narrative:"O ECG mostra bradicardia leve. O protocolo escolhido define o destino de {{dogName}}.",question:"Qual conduta seguir?",options:[{text:"1Ô∏è‚É£ Administrar gluconato de c√°lcio 10% IV lento com monitoriza√ß√£o.",feedback:"ü©∫ Feedback: Perfeito. 1 ml/kg lentamente, monitorando o cora√ß√£o; depois c√°lcio oral e dieta balanceada.",tone:"success",outcome:"best"},{text:"2Ô∏è‚É£ Aplicar ocitocina para ‚Äúesvaziar o leite‚Äù.",feedback:"‚ùå Feedback: Grave erro. Sem c√°lcio, o √∫tero n√£o responde e o quadro piora.",tone:"neutral",outcome:"critical"},{text:"3Ô∏è‚É£ Aplicar dipirona e esperar melhorar.",feedback:"‚ö†Ô∏è Feedback: Tratamento sintom√°tico que n√£o resolve a causa; {{dogName}} continuaria tremendo.",tone:"warning",outcome:"bad"}]},{id:"fase3-d4",title:"Decis√£o 4 ‚Äì Manejo ap√≥s estabiliza√ß√£o",narrative:"{{dogName}} respira melhor, mas ainda est√° fraca e os filhotes t√™m fome.",question:"Como manejar a amamenta√ß√£o?",options:[{text:"1Ô∏è‚É£ Devolver todos os filhotes para mamar livremente.",feedback:"‚ùå Feedback: Recidiva quase certa. √â preciso reduzir o tempo de mamada e suplementar artificialmente.",tone:"neutral",outcome:"bad"},{text:"2Ô∏è‚É£ Permitir mamadas controladas e suplementar artificialmente.",feedback:"ü©∫ Feedback: Correto. Mant√©m a lacta√ß√£o sem sobrecarregar o metabolismo de c√°lcio.",tone:"success",outcome:"best"},{text:"3Ô∏è‚É£ Suspender totalmente a amamenta√ß√£o.",feedback:"‚ö†Ô∏è Feedback: Pode causar ingurgitamento mam√°rio e desconforto intenso.",tone:"warning",outcome:"bad"}]},{id:"fase3-d5",title:"Decis√£o 5 ‚Äì Preven√ß√£o da recidiva",narrative:"{{dogName}} est√° recuperada, mas ainda lactando.",question:"Qual conduta evita uma nova crise?",options:[{text:"1Ô∏è‚É£ Reintroduzir c√°lcio oral em doses fracionadas durante a lacta√ß√£o.",feedback:"ü©∫ Feedback: Correto. Suplementa√ß√£o controlada mant√©m o equil√≠brio Ca:P e previne novas quedas.",tone:"success",outcome:"best"},{text:"2Ô∏è‚É£ Retirar totalmente o c√°lcio para ‚Äún√£o viciar o corpo‚Äù.",feedback:"‚ùå Feedback: Mito perigoso. A aus√™ncia completa favorece nova hipocalcemia.",tone:"neutral",outcome:"bad"},{text:"3Ô∏è‚É£ Oferecer leite e queijo √† vontade.",feedback:"üòÇ Feedback: ‚ÄúSuplementa√ß√£o √† la padaria‚Äù n√£o equilibra Ca:P e ainda pode gerar diarreia.",tone:"fun",outcome:"bad"}]}],l=[{id:"fase1",title:"üìò Fase 1 ‚Äì Voc√™ sabe o que √© Hipocalcemia?",intro:["Voc√™ √© um tutor curioso e estudante de veterin√°ria.","Est√° acompanhando sua cadela {{dogName}}, uma futura mam√£e.","Antes de mergulhar na hist√≥ria, decide revisar o b√°sico: ‚ÄúO que exatamente √© essa tal de hipocalcemia?‚Äù"],decisions:V},{id:"fase2",title:"ü©∫ Fase 2 ‚Äì {{dogName}}, a m√£e de primeira viagem",intro:["A gesta√ß√£o avan√ßa. Cada escolha molda o cen√°rio metab√≥lico e hormonal para o parto.","Equil√≠brio, fisiologia e paci√™ncia s√£o as palavras de ordem."],decisions:Q},{id:"fase3",title:"üÜò Fase 3 ‚Äì O parto e os primeiros sinais",intro:["Os filhotes j√° nasceram, mas os riscos continuam.","Hipocalcemia p√≥s-parto √© trai√ßoeira; agir r√°pido salva vidas."],decisions:G}],K={happy:{title:"üü¢ Final Feliz ‚Äî M√£e e filhotes salvos",highlight:"Controle e ci√™ncia em todas as fases garantiram a recupera√ß√£o completa de {{dogName}}.",highlightTone:"success",sections:[{heading:"Condi√ß√£o",body:"Voc√™ seguiu as condutas corretas em cada fase, mantendo suplementa√ß√£o oral controlada e check-ups constantes."},{heading:"Cen√°rio",body:"{{dogName}} est√° tranquila, alimentando os filhotes sob vigil√¢ncia. O c√°lcio s√©rico est√° normal e o corpo responde bem."},{heading:"Desfecho",body:"Recupera√ß√£o completa, lacta√ß√£o mantida e filhotes fortes. A preven√ß√£o exige fisiologia e paci√™ncia ‚Äî a pressa mata, o equil√≠brio cura."}]},partial:{title:"üü° Final Neutro ‚Äî Vida salva, aprendizado intenso",highlight:"Algumas decis√µes vacilaram, mas o tratamento correto evitou o pior para {{dogName}}.",highlightTone:"warning",sections:[{heading:"Condi√ß√£o",body:"Alguma escolha falhou na gesta√ß√£o ou no manejo p√≥s-parto, por√©m a crise foi reconhecida e tratada a tempo."},{heading:"Cen√°rio",body:"Ap√≥s estabilizar {{dogName}}, faltou controlar as mamadas e ajustar suplementa√ß√£o. Tremores leves retornaram e dois filhotes precisaram de leite artificial."},{heading:"Desfecho",body:"{{dogName}} sobrevive, mas perde parte da produ√ß√£o l√°ctea. Instinto materno n√£o substitui manejo cl√≠nico."}]},tragic:{title:"üî¥ Final Tr√°gico ‚Äî Ecl√¢mpsia fatal",highlight:"Ignorar sinais cr√≠ticos ou usar protocolos errados fez o c√°lcio n√£o esperar por {{dogName}}.",highlightTone:"danger",sections:[{heading:"Condi√ß√£o",body:"Sinais foram ignorados ou ocitocina foi aplicada sem avalia√ß√£o. A hipocalcemia evoluiu sem controle."},{heading:"Cen√°rio",body:"{{dogName}} entrou em crise com tremores, rigidez e convuls√µes. A tentativa de ‚Äúresolver em casa‚Äù atrasou o tratamento."},{heading:"Desfecho",body:"A bradicardia refrat√°ria levou √† morte. Fica o registro: carinho sem fisiologia n√£o salva vidas."}]}};let f=null,s=0,d=0,m=!1,S=!1;function c(e){const t=r.dogName||"Mel";return e.replace(/\{\{dogName\}\}/g,t)}function p(){if(!f){const e=document.getElementById("storyPhaseTitle"),t=document.getElementById("storyPhaseIntro"),a=document.getElementById("storyProgress"),o=document.getElementById("storyDecisionTitle"),i=document.getElementById("storyDecisionDescription"),n=document.getElementById("storyOptions"),u=document.getElementById("storyFeedback"),v=document.getElementById("storyNextButton"),k=document.getElementById("storyEndingTitle"),y=document.getElementById("storyEndingHighlight"),x=document.getElementById("storyEndingDetails"),C=document.getElementById("storyEndingStats");e instanceof HTMLElement&&t instanceof HTMLElement&&a instanceof HTMLElement&&o instanceof HTMLElement&&i instanceof HTMLElement&&n instanceof HTMLElement&&u instanceof HTMLElement&&v instanceof HTMLButtonElement&&k instanceof HTMLElement&&y instanceof HTMLElement&&x instanceof HTMLElement&&C instanceof HTMLElement&&(f={phaseTitle:e,phaseIntro:t,progress:a,decisionTitle:o,decisionDescription:i,optionsContainer:n,feedbackContainer:u,nextButton:v,endingTitle:k,endingHighlight:y,endingDetails:x,endingStats:C})}return f}function J(e,t){const a=document.createElement("button");return a.type="button",a.className="story-option-button",a.textContent=c(e.text),a.dataset.index=String(t),a.addEventListener("click",()=>_(e,a)),a}function U(e,t){t.innerHTML=e.intro.map(a=>`<p>${c(a)}</p>`).join("")}function W(e,t,a){t.textContent=c(e.title);const o=[];e.narrative&&o.push(e.narrative),o.push(e.question),a.innerHTML=c(o.join("<br><br>"))}function Z(e,t,a){const o=l[t];e.textContent=`Fase ${t+1} de ${l.length} ¬∑ Pergunta ${a+1} de ${o.decisions.length}`}function D(e){const t=l[s],a=d===t.decisions.length-1,o=s===l.length-1;a&&o?e.textContent="Ver desfecho":a?e.textContent="Avan√ßar para a pr√≥xima fase":e.textContent="Pr√≥xima decis√£o"}function g(e){return`tone-${e}`}function _(e,t){if(m)return;const a=p();a&&(m=!0,w(e.outcome),a.optionsContainer.querySelectorAll("button").forEach(o=>{o.setAttribute("disabled","true"),o.classList.add("answered")}),t.classList.add("selected",g(e.tone)),a.feedbackContainer.innerHTML=`<div class="story-feedback ${g(e.tone)}">${c(e.feedback)}</div>`,D(a.nextButton),a.nextButton.disabled=!1)}function X(e){e.feedbackContainer.innerHTML=""}function b(){const e=p();if(!e)return;const t=l[s],a=t.decisions[d];m=!1,e.nextButton.disabled=!0,e.phaseTitle.textContent=c(t.title),U(t,e.phaseIntro),W(a,e.decisionTitle,e.decisionDescription),Z(e.progress,s,d),D(e.nextButton),X(e),e.optionsContainer.innerHTML="",a.options.forEach((o,i)=>{const n=J(o,i);e.optionsContainer.appendChild(n)})}function Y(){const e=l[s];if(!(d===e.decisions.length-1)){d+=1,b();return}if(!(s===l.length-1)){s+=1,d=0,b();return}te()}function ee(){const e=r.storyStats;return e.criticalMistakes>0?"tragic":e.totalCorrect===e.totalDecisions&&e.totalDecisions>0?"happy":(e.majorMistakes>0||e.totalDecisions===0,"partial")}function ae(e){const{totalCorrect:t,totalDecisions:a,majorMistakes:o,criticalMistakes:i}=r.storyStats;e.endingStats.innerHTML=`
    <div class="story-score">
      <div><strong>Decis√µes corretas:</strong> ${t} / ${a}</div>
      <div><strong>Erros graves:</strong> ${o}</div>
      <div><strong>Crises ignoradas:</strong> ${i}</div>
    </div>
  `}function te(){const e=p();if(!e)return;const t=ee(),a=K[t];e.endingTitle.textContent=a.title,e.endingHighlight.className=`story-ending-highlight ${g(a.highlightTone)}`,e.endingHighlight.textContent=c(a.highlight),e.endingDetails.innerHTML=a.sections.map(o=>`
      <div class="story-ending-section">
        <h3>${o.heading}</h3>
        <p>${c(o.body)}</p>
      </div>
    `).join(""),ae(e),h(4)}function oe(){s=0,d=0,m=!1,A()}function ie(){m&&Y()}function ne(){if(S)return;const e=p();e&&(e.nextButton.addEventListener("click",ie),S=!0)}function re(){p()&&(oe(),b())}document.addEventListener("DOMContentLoaded",()=>{R(),T(),ne()});function se(e){h(e),e===3&&re()}window.goToStep=se;window.showInfo=j;window.showCredits=$;window.selectCharacter=B;window.completeStep1=z;window.randomName=T;
